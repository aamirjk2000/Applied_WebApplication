@page
@using System.Data
@using Applied_WebApplication.Data;
@using Microsoft.Extensions.Primitives
@model Applied_WebApplication.Pages.Stock.InventoryModel
@{
    var UserName = User.Identity.Name;
    var Inventory = new DataTableClass(UserName, Tables.Inventory);
    var SubCat = new DataTableClass(UserName, Tables.Inv_SubCategory);
    var UOM = new DataTableClass(UserName, Tables.Inv_UOM);

    if (Model.IsError)
    {
        if (Inventory.CurrentRow == null) { Inventory.NewRecord(); }
        List<KeyValuePair<string, StringValues>> _Values = Request.Form.ToList();
        foreach (KeyValuePair<string, StringValues> _KeyValue in _Values)
        {
            if (_KeyValue.Key == "Code") { Model.Record.Code = _KeyValue.Value; }
            if (_KeyValue.Key == "Title") { Model.Record.Title = _KeyValue.Value; }
            if (_KeyValue.Key == "SubCategory") { Model.Record.Title = _KeyValue.Value; }
            if (_KeyValue.Key == "UOM") { Model.Record.Title = _KeyValue.Value; }
            if (_KeyValue.Key == "Notes") { Model.Record.Title = _KeyValue.Value; }
        }
    }
}

<div class="col-md-7 col-lg-8">
    <form method="post">
        <div class="text-danger" asp-validation-summary="ModelOnly"></div>
        <div class=container>
            <div class="row g-1">

                <div class="col-sm-2">
                    <label asp-for=@Model.Record.ID class="form-label">Record ID</label>
                    <input type="text" asp-for=@Model.Record.ID name="ID" class="form-control" placeholder="" value=@Model.Record.ID readonly>
                </div>

                <div class="col-sm-3">
                    <label asp-for=@Model.Record.Code class="form-label">Customer Code</label>
                    <div class="input-group has-validation">
                        <span class="input-group-text">Code</span>
                        <input type="text" asp-for=@Model.Record.Code name="Code" class="form-control" placeholder="Customer Code" value=@Model.Record.Code required="">
                        <span class="text-danger" asp-validation-for=@Model.Record.Code> </span>
                    </div>
                </div>

                <div class="col-sm-7">
                    <label asp-for=@Model.Record.Title class="form-label">Customer Name</label>
                    <div class="input-group has-validation">
                        <span class="input-group-text">Customer</span>
                        <input type="text" asp-for=@Model.Record.Title name="Title" class="form-control" placeholder="Customer Name" value=@Model.Record.Title required="">
                        <span class="text-danger" asp-validation-for=@Model.Record.Title> </span>
                    </div>
                </div>

                <div class="col-md-12">
                    <label asp-for=@Model.Record.SubCategory class="form-label">Country</label>
                    <select class="form-select" name="SubCategory" asp-for=@Model.Record.SubCategory>
                        <option value=@Model.Record.SubCategory>Choose...</option>
                        @foreach (DataRow _Row in SubCat.MyDataTable.Rows)
                        {
                            <option value=@_Row["ID"]> @_Row["Title"] </option>
                        }
                        <div class="invalid-feedback">
                            Please select a Category of Inventory.
                        </div>
                    </select>
                </div>

                <div class="col-md-12">
                    <label asp-for=@Model.Record.UOM class="form-label">Country</label>
                    <select class="form-select" name="UOM" asp-for=@Model.Record.UOM>
                        <option value=@Model.Record.UOM>Choose...</option>
                        @foreach (DataRow _Row in UOM.MyDataTable.Rows)
                        {
                            <option value=@_Row["ID"]> @_Row["Title"] </option>
                        }
                        <div class="invalid-feedback">
                            Please select a Category of Inventory.
                        </div>
                    </select>
                </div>


                <br />
                <hr class="m-2">

                <div class="row g-md-1">
                    @if (Model.MyPageAction == "Delete")
                    {
                        <button class="btn btn-primary p-1" type="submit" asp-page-handler="Delete" asp-route-UserName=@UserName>Delete</button>
                    }
                    else
                    {
                        <button class="btn btn-primary p-1" type="submit" asp-page-handler="Save" asp-route-UserName=@UserName>Save</button>
                        <button class="btn btn-primary p-1" type="submit" asp-page="Inventories">Back</button>
                    }
                </div>

            </div>
        </div>
    </form>
</div>